{% extends 'base.html' %}


{% block content %}
    
    <div class="row article-container">
        <div class="col s12 m8 l8 offset-m3 offset-l2">
            <h4 class="center">{{post_detail.title}}</h4>
        </div>
        <div class="col s12 m10 l8 offset-m1 offset-l2 post-image">
            <img src="{{post_detail.featured_image.url}}" alt="image for {{post_detail.title}}" class="">
        </div>
        <div class="col s12 m10 l8 offset-m1 offset-l2 post-content">
            {{post_detail.content}}
        </div>
        <div class="col s12 m10 l8 offset-m1 offset-l2">
            <small>Author: {{post_detail.author}}</small>
        </div>
        <div class="col s12 m10 l8 offset-m1 offset-l2">
            <small>Created On: {{post_detail.created_on}}</small>
        </div>
    </div>

    <div class="row">
        <h5 class="col s2 m2 l2">Comments:</h5>
    </div>

    {% if user.is_authenticated %}

        <div class="row">

            <form action="{% url 'post_comment' post_detail.slug %}" method="POST" class="col s12 m8 l6 comment-box">
                {{comment_form}}
                {% csrf_token %}
                <button class="btn right">Submit</button>
            </form>

        </div>
    {% endif %}

    {% if comments %}

        {% if post_detail.author == request.user %}
            <hr style="margin-block-start: 1.5rem;">
            <div class="row">
                <h6 class="col s12 m6 l4">Pending Approval:</h6>
            </div>
        {% endif %}
    
        {% for comment in comments  %}
            {% if post_detail.author == request.user and not comment.approved %}
                <div class="row">
                    <div class="col s12 m6 l4">
                        <a>{{comment.commented_by}}:</a>
                        <span>{{comment.commented_text}}</span>
                    </div>
                    <div class="col s12 m4 l4">
                        <form action="{% url 'comment_approve' comment.id %}" method="POST" style="display: inline;">
                            {% csrf_token %}
                            <button class="btn-small approval-btn" type="submit">Approve</button>
                        </form>
                        <button data-target="modal1" data-type ="{{comment.id}}" class="btn-small modal-trigger approval-btn" style="display: inline;">Delete</a>
                    </div>
                </div>
                <hr style="margin-block-end: 1.5rem;">
                
            {% endif %}
        {% endfor %}

        {% for comment in comments %}
            {% if comment.approved %}
                <div class="row">
                    <div class="col s12 m6 l4">
                        <a>{{comment.commented_by}}:</a>
                        <span>{{comment.commented_text}}</span>
                    </div>
                </div>
                <hr style="margin-block-end: 1.5rem;">
            {% endif %}
        {% endfor %}

    {% else %}
        <p>No comments</p>
    {% endif %}

    <div id="modal1" class="modal">
        <div class="modal-content">
          <p>Are you sure you want to delete this comment?</p>
        </div>
        <div class="modal-footer">
            <form method="POST" style="display: inline;" class="approval-delete-form" >
                {% csrf_token %}
                <button class="btn-small" type="submit">Agree</button>
            </form>
            <button class="modal-close btn-small" style="display: inline;">Cancel</button>
        </div>
    </div>

{% endblock %}